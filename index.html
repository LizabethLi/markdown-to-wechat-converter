<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown to å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆè½¬æ¢å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            height: calc(100vh - 180px);
            min-height: 600px;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-header {
            background: #f8fafc;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-title {
            font-weight: 600;
            color: #334155;
            font-size: 1.1rem;
        }
        
        .btn {
            background: #7E3AF2;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #6d28d9;
            transform: translateY(-1px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.success {
            background: #10b981;
        }
        
        .panel-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        #markdownInput {
            flex: 1;
            border: none;
            padding: 1.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            background: #fafafa;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        #markdownInput::-webkit-scrollbar {
            width: 8px;
        }
        
        #markdownInput::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #markdownInput::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        #markdownInput::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        #htmlOutput {
            flex: 1;
            border: none;
            padding: 1.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            resize: none;
            outline: none;
            background: #f8f9fa;
            color: #495057;
            overflow-y: auto;
            max-height: calc(100vh - 400px);
            min-height: 400px;
            scroll-behavior: smooth;
        }
        
        #htmlOutput::-webkit-scrollbar {
            width: 8px;
        }
        
        #htmlOutput::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #htmlOutput::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        #htmlOutput::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        #preview {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: white;
            max-height: calc(100vh - 400px);
            min-height: 400px;
            scroll-behavior: smooth;
        }
        
        /* KaTeX å­—ä½“å¤§å°è°ƒæ•´ */
        .katex { font-size: 1.1em; }
        
        #preview::-webkit-scrollbar {
            width: 8px;
        }
        
        #preview::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #preview::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        #preview::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: #64748b;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: #7E3AF2;
            border-bottom-color: #7E3AF2;
            background: white;
        }
        
        .tab-content {
            display: none;
            flex: 1;
            flex-direction: column;
        }
        
        .tab-content.active {
            display: flex;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
                gap: 1rem;
                padding: 1rem;
                min-height: auto;
            }
            
            .panel {
                height: 500px;
                min-height: 500px;
            }
            
            #preview, #htmlOutput {
                max-height: 350px;
                min-height: 350px;
            }
            
            #markdownInput {
                min-height: 350px;
            }
        }
        
        /* å¾®ä¿¡å…¬ä¼—å·æ ·å¼é¢„è§ˆ */
        .wechat-preview {
            font-family: "PingFang SC", system-ui, -apple-system, "Helvetica Neue", "Microsoft YaHei", Arial, sans-serif;
            color: rgba(0, 0, 0, 0.9);
            line-height: 1.5em;
        }
        
        .demo-section {
            margin: 2rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #7E3AF2;
        }
        
        .demo-title {
            font-weight: 600;
            color: #7E3AF2;
            margin-bottom: 1rem;
        }
        
        table {
            border-collapse: collapse;
            margin: 15px 0;
            width: 100%;
            border: 1px solid #e2e8f0;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 10px 12px;
            text-align: left;
        }
        
        th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #334155;
        }
        
        tr:nth-child(even) {
            background-color: #f8fafc;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruJ+a13U8yHIkAyOUuD3QAWDk/a3KYZ2/f9S62AANe4e1HN5dgTICI+VE9aLJ9" crossorigin="anonymous">
</head>
<body>
    <div id="scratch" style="display:none;"></div>
    <div class="header">
        <h1>ğŸ“ Markdown to å¾®ä¿¡å…¬ä¼—å·æ’ç‰ˆè½¬æ¢å™¨</h1>
        <p>ä¸€é”®å°† Markdown è½¬æ¢ä¸ºå¾®ä¿¡å…¬ä¼—å·æ ·å¼ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆ</p>
    </div>
    
    <div class="container">
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">ğŸ“ Markdown è¾“å…¥</span>
                <div>
                    <select id="modeSelect" style="margin-right: 10px; padding: 5px; border: 1px solid #ddd; border-radius: 4px;" onchange="updateOutput()">
                        <option value="compact">ç´§å‡‘æ¨¡å¼</option>
                        <option value="standard">æ ‡å‡†æ¨¡å¼</option>
                    </select>
                    <button class="btn" onclick="loadExample()">åŠ è½½ç¤ºä¾‹</button>
                </div>
            </div>
            <div class="panel-content">
                <textarea id="markdownInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ Markdown å†…å®¹...

ğŸ’¡ ä½¿ç”¨æç¤ºï¼š
â€¢ ç´§å‡‘æ¨¡å¼ï¼šå»é™¤æ‰€æœ‰æ¢è¡Œï¼Œé€‚åˆå¾®ä¿¡å…¬ä¼—å·ï¼ˆæ¨èï¼‰
â€¢ æ ‡å‡†æ¨¡å¼ï¼šä¿ç•™æ ¼å¼ï¼Œé€‚åˆå…¶ä»–ç¼–è¾‘å™¨
â€¢ æ”¯æŒåµŒå¥—åˆ—è¡¨ï¼šä½¿ç”¨4ä¸ªç©ºæ ¼ç¼©è¿›è¡¨ç¤ºä¸‹ä¸€çº§

ç¤ºä¾‹ï¼š
# è¿™æ˜¯ä¸»æ ‡é¢˜
## è¿™æ˜¯å‰¯æ ‡é¢˜  
### è¿™æ˜¯å°æ ‡é¢˜

è¿™æ˜¯ä¸€æ®µæ­£æ–‡ï¼Œæ”¯æŒ **ç²—ä½“** å’Œ *æ–œä½“*ã€‚

- **ä¸€çº§åˆ—è¡¨é¡¹ç›®1**
    - äºŒçº§åˆ—è¡¨é¡¹ç›®1
    - äºŒçº§åˆ—è¡¨é¡¹ç›®2
        - ä¸‰çº§åˆ—è¡¨é¡¹ç›®1
        - ä¸‰çº§åˆ—è¡¨é¡¹ç›®2
- **ä¸€çº§åˆ—è¡¨é¡¹ç›®2**
    - äºŒçº§åˆ—è¡¨é¡¹ç›®3

> è¿™æ˜¯å¼•ç”¨å†…å®¹

```javascript
console.log('Hello, world!');
```

| è¡¨å¤´1 | è¡¨å¤´2 |
|---|---|
| å•å…ƒæ ¼1 | å•å…ƒæ ¼2 |

è¡Œå†…å…¬å¼ï¼š$E = mc^2$

å—çº§å…¬å¼ï¼š$$ \frac{-b \pm \sqrt{b^2-4ac}}{2a} $$

![å›¾ç‰‡æè¿°](https://via.placeholder.com/400x200)

ğŸ”¥ å¤åˆ¶åˆ°å¾®ä¿¡å…¬ä¼—å·æ—¶è¯·ä½¿ç”¨ã€ç²˜è´´å¹¶ä¿ç•™æ ¼å¼ã€‘æˆ–ã€Ctrl+Shift+Vã€‘
"></textarea>
            </div>
        </div>
        
        <div class="panel">
            <div class="tabs">
                <button class="tab active" onclick="showTab('preview')">ğŸ” é¢„è§ˆ</button>
                <button class="tab" onclick="showTab('html')">ğŸ“„ HTMLä»£ç </button>
            </div>
            
            <div id="previewTab" class="tab-content active">
                <div class="panel-header">
                    <span class="panel-title">ğŸ‘€ æ•ˆæœé¢„è§ˆ (å¯æ»šåŠ¨æŸ¥çœ‹)</span>
                    <button class="btn" id="copyPreviewBtn" onclick="copyPreview()">å¤åˆ¶æ ·å¼ä»£ç </button>
                </div>
                <div id="preview" class="wechat-preview"></div>
            </div>
            
            <div id="htmlTab" class="tab-content">
                <div class="panel-header">
                    <span class="panel-title">ğŸ“‹ HTML ä»£ç  (å¯æ»šåŠ¨æŸ¥çœ‹)</span>
                    <button class="btn" id="copyHtmlBtn" onclick="copyHtml()">å¤åˆ¶ä»£ç </button>
                </div>
                <textarea id="htmlOutput" readonly></textarea>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqKaLiZWC2GeOhXCI2eJt89KCtEpPlC+bb9HvpYa+5YKS" crossorigin="anonymous"></script>
    <script>
        const wechatStylesCompact = {
            sectionNumber: (match, number) => 
                `<section style="text-align: center; margin: 20px 0 15px 0;"><p style="font-size: 28px; color: rgb(0, 0, 0); line-height: 1.2; font-weight: bold; margin: 0;">${number.padStart(2, '0')}</p></section>`,
            
            h1: (match, text) => 
                `<section style="text-align: center; margin: 25px 0 15px 0;"><p style="min-height: 1em; color: rgb(51, 51, 51); line-height: 1.4; margin: 0;"><strong><span style="background: rgb(126, 58, 242); color: white; padding: 6px 12px; border-radius: 4px; font-size: 16px;">${text}</span></strong></p></section>`,
            
            h2: (match, text) => 
                `<p style="font-size: 20px; font-weight: bold; margin: 25px 0 15px 0; padding-left: 12px; border-left: 4px solid #7E3AF2; line-height: 1.3;"><span style="font-weight: bold; color: #333;">${text}</span></p>`,
            
            h3: (match, text) => 
                `<h3 style="line-height: 1.4; font-size: 16px; margin: 20px 0 10px 0; color: #333; font-weight: bold;">${text}</h3>`,
            
            bold: (match, text) => `<strong style="font-weight: bold; color: #333;">${text}</strong>`,
            
            italic: (match, text) => `<em style="font-style: italic;">${text}</em>`,
            
            unorderedList: (match, text) => 
                `<li style="margin: 5px 0; line-height: 1.6; list-style-type: disc;"><span style="font-size: 14px; color: #333;">${text}</span></li>`,
            
            orderedList: (match, text) => 
                `<li style="margin: 5px 0; line-height: 1.6;"><span style="font-size: 14px; color: #333;">${text}</span></li>`,
            
            blockquote: (match, text) => 
                `<blockquote style="margin: 15px 0; padding: 12px 16px; background: #f8f9fa; border-left: 4px solid #7E3AF2; border-radius: 4px;"><p style="line-height: 1.6; margin: 0; font-size: 14px; color: #555; font-style: italic;">${text}</p></blockquote>`,
            
            codeBlock: (match, lang, code) => 
                `<pre style="background: #f8f9fa; padding: 12px; border-radius: 6px; overflow-x: auto; margin: 15px 0; border: 1px solid #e9ecef; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 13px; line-height: 1.4; color: #333;">${code.trim()}</pre>`,
            
            inlineCode: (match, code) => 
                `<code style="background: #f1f3f4; padding: 2px 6px; border-radius: 3px; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 13px; color: #d73a49;">${code}</code>`,
            
            image: (match, alt, src) => {
                const altText = alt ? `<p style="font-size: 12px; color: #999; margin: 5px 0 0 0; font-style: italic; text-align: center;">${alt}</p>` : '';
                return `<section style="text-align: center; margin: 20px 0;"><img src="${src}" alt="${alt}" style="max-width: 100%; height: auto; border-radius: 6px;">${altText}</section>`;
            },
            
            link: (match, text, url) => 
                `<a href="${url}" style="color: #7E3AF2; text-decoration: none; border-bottom: 1px solid #7E3AF2;" target="_blank">${text}</a>`,
            
            paragraph: (match, text) => {
                if (text.trim() === '') return '';
                return `<p style="line-height: 1.7; margin: 12px 0; font-size: 15px; color: #333; text-align: justify;">${text}</p>`;
            }
        };

        // æ ‡å‡†æ¨¡å¼æ ·å¼ï¼ˆä¿æŒåŸæœ‰æ ¼å¼ï¼Œé€‚å½“æ¢è¡Œï¼‰
        const wechatStylesStandard = {
            sectionNumber: (match, number) => 
                `<section style="text-align: center; margin: 30px 0;">
                    <p style="font-size: 28px; color: rgb(0, 0, 0); line-height: 40px; font-weight: bold;">
                        ${number.padStart(2, '0')}
                    </p>
                </section>`,
            
            h1: (match, text) => 
                `<section style="text-align: center; margin: 30px 0 20px 0;">
                    <p style="min-height: 1em; color: rgb(51, 51, 51); line-height: 22px;">
                        <strong>
                            <span style="background: rgb(126, 58, 242); color: white; padding: 6px 12px; border-radius: 4px;">
                                ${text}
                            </span>
                        </strong>
                    </p>
                </section>`,
            
            h2: (match, text) => 
                `<p style="font-size: 22px; font-weight: bold; margin: 30px 0 20px 0; padding-left: 12px; border-left: 4px solid #7E3AF2; line-height: 1.4;">
                    <span style="font-weight: bold; color: #333;">${text}</span>
                </p>`,
            
            h3: (match, text) => 
                `<h3 style="line-height: 1.5em; font-size: 18px; margin: 20px 0 10px 0; color: #333;">
                    <span style="font-weight: bold;">${text}</span>
                </h3>`,
            
            bold: (match, text) => `<strong style="font-weight: bold; color: #333;">${text}</strong>`,
            
            italic: (match, text) => `<em style="font-style: italic;">${text}</em>`,
            
            unorderedList: (match, text) => 
                `<li style="margin: 8px 0; line-height: 1.6;">
                    <span style="font-size: 14px; color: #333;">${text}</span>
                </li>`,
            
            orderedList: (match, text) => 
                `<li style="margin: 8px 0; line-height: 1.6;">
                    <span style="font-size: 14px; color: #333;">${text}</span>
                </li>`,
            
            blockquote: (match, text) => 
                `<blockquote style="margin: 20px 0; padding: 15px 20px; background: #f8f9fa; border-left: 4px solid #7E3AF2; border-radius: 4px;">
                    <p style="line-height: 1.6; margin: 0; font-size: 14px; color: #555; font-style: italic;">
                        ${text}
                    </p>
                </blockquote>`,
            
            codeBlock: (match, lang, code) => 
                `<pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 20px 0; border: 1px solid #e9ecef;">
                    <code style="font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 13px; line-height: 1.4; color: #333;">${code.trim()}</code>
                </pre>`,
            
            inlineCode: (match, code) => 
                `<code style="background: #f1f3f4; padding: 2px 6px; border-radius: 3px; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 13px; color: #d73a49;">${code}</code>`,
            
            image: (match, alt, src) => {
                const altText = alt ? `<p style="font-size: 12px; color: #999; margin: 8px 0 0 0; font-style: italic;">${alt}</p>` : '';
                return `<section style="text-align: center; margin: 25px 0;">
                    <img src="${src}" alt="${alt}" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    ${altText}
                </section>`;
            },
            
            link: (match, text, url) => 
                `<a href="${url}" style="color: #7E3AF2; text-decoration: none; border-bottom: 1px solid #7E3AF2;" target="_blank">${text}</a>`,
            
            paragraph: (match, text) => {
                if (text.trim() === '') return '';
                return `<p style="line-height: 1.8; margin: 15px 0; font-size: 15px; color: #333; text-align: justify;">${text}</p>`;
            }
        };
        
        function createWechatRenderer(mode) {
            const wechatStyles = mode === 'compact' ? wechatStylesCompact : wechatStylesStandard;
            const renderer = new marked.Renderer();

            renderer.heading = (text, level, raw) => {
                if (level === 1) return wechatStyles.h1(raw, text);
                if (level === 2) return wechatStyles.h2(raw, text);
                if (level === 3) {
                    const sectionMatch = raw.match(/^###\s(\d+)/);
                    if (sectionMatch && raw.trim().split(/\s+/).length === 2) {
                        return wechatStyles.sectionNumber(raw, sectionMatch[1]);
                    }
                    return wechatStyles.h3(raw, text);
                }
                return `<h${level} style="font-size: ${18 - level}px; font-weight: bold; margin: 15px 0;">${text}</h${level}>`;
            };

            renderer.paragraph = (text) => {
                // é¿å… marked.js ç»™å·²ç»æœ‰æ ·å¼çš„å—ï¼ˆå¦‚KaTeXæ¸²æŸ“çš„å—ï¼‰å†æ¬¡å¥—ä¸Š <p> æ ‡ç­¾
                if (text.trim().startsWith('<section') && text.trim().endsWith('</section>')) {
                    return text;
                }
                return wechatStyles.paragraph(null, text);
            };

            renderer.strong = (text) => wechatStyles.bold(null, text);
            renderer.em = (text) => wechatStyles.italic(null, text);

            renderer.list = (body, ordered, start) => {
                const tag = ordered ? 'ol' : 'ul';
                const styles = mode === 'compact' 
                    ? `list-style-position: inside; padding: 0; margin: 8px 0;`
                    : `padding-left: 25px; margin: 15px 0;`;
                return `<${tag} style="${styles}">${body}</${tag}>`;
            };

            renderer.listitem = (text) => {
                const style = mode === 'compact'
                    ? `margin: 5px 0; line-height: 1.6; font-size: 14px; color: #333;`
                    : `margin: 8px 0; line-height: 1.6; font-size: 14px; color: #333;`;
                // å¤„ç†åµŒå¥—åˆ—è¡¨çš„<p>æ ‡ç­¾é—®é¢˜
                const cleanedText = text.replace(/<p>([\s\S]*?)<\/p>/g, '$1');
                return `<li style="${style}">${cleanedText}</li>`;
            };

            renderer.blockquote = (quote) => {
                const unwrappedQuote = quote.replace(/^<p>([\s\S]*)<\/p>\n?$/, '$1');
                return wechatStyles.blockquote(null, unwrappedQuote);
            };

            renderer.code = (code, lang, escaped) => wechatStyles.codeBlock(null, lang, code);
            renderer.codespan = (code) => wechatStyles.inlineCode(null, code);
            renderer.image = (href, title, text) => wechatStyles.image(null, text, href);
            renderer.link = (href, title, text) => wechatStyles.link(null, text, href);

            renderer.table = (header, body) => {
                return `<table style="border-collapse: collapse; margin: 15px 0; width: 100%; border: 1px solid #e2e8f0;"><thead>${header}</thead><tbody>${body}</tbody></table>`;
            };
            
            renderer.tablerow = (content) => {
                return `<tr style="border-bottom: 1px solid #e2e8f0;">${content}</tr>`;
            };

            renderer.tablecell = (content, flags) => {
                const tag = flags.header ? 'th' : 'td';
                const textAlign = flags.align ? `text-align: ${flags.align};` : '';
                const style = flags.header
                    ? `background-color: #f8fafc; font-weight: 600; color: #334155; border: 1px solid #e2e8f0; padding: 10px 12px; ${textAlign}`
                    : `border: 1px solid #e2e8f0; padding: 10px 12px; ${textAlign}`;
                return `<${tag} style="${style}">${content}</${tag}>`;
            };

            return renderer;
        }

        function convertMarkdownToWechat(markdown) {
            const mode = document.getElementById('modeSelect').value;
            
            // 1. ä¿æŠ¤æ•°å­¦å…¬å¼ï¼Œæ›¿æ¢ä¸ºå ä½ç¬¦
            const mathPlaceholders = {};
            let mathCounter = 0;
            
            // å—çº§å…¬å¼
            markdown = markdown.replace(/\$\$([\s\S]*?)\$\$/g, (match, latex) => {
                const placeholder = `__MATH_BLOCK_${mathCounter++}__`;
                mathPlaceholders[placeholder] = latex;
                return placeholder;
            });

            // è¡Œå†…å…¬å¼
            markdown = markdown.replace(/\$([^$]+?)\$/g, (match, latex) => {
                const placeholder = `__MATH_INLINE_${mathCounter++}__`;
                mathPlaceholders[placeholder] = latex;
                return placeholder;
            });

            // 2. ä½¿ç”¨ marked.js è¿›è¡Œè½¬æ¢
            const renderer = createWechatRenderer(mode);
            marked.setOptions({ renderer });
            let html = marked.parse(markdown);

            // 3. æ¢å¤æ•°å­¦å…¬å¼å¹¶ç”¨ KaTeX æ¸²æŸ“
            html = html.replace(/__MATH_BLOCK_(\d+)__/g, (match) => {
                const latex = mathPlaceholders[match];
                try {
                    return `<section style="text-align:center; margin: 15px 0; overflow-x: auto; overflow-y: hidden;">${katex.renderToString(latex, { throwOnError: false, displayMode: true })}</section>`;
                } catch (e) {
                    return `<p style="color:red;">KaTeX Error: ${e.message}</p>`;
                }
            });
            html = html.replace(/__MATH_INLINE_(\d+)__/g, (match) => {
                const latex = mathPlaceholders[match];
                try {
                    return katex.renderToString(latex, { throwOnError: false, displayMode: false });
                } catch (e) {
                    return `<code style="color:red; font-size: 1em;">KaTeX Error</code>`;
                }
            });
            
            // 4. æ ¹æ®æ¨¡å¼è¿›è¡Œæœ€ç»ˆæ¸…ç†
            if (mode === 'compact') {
                html = html.replace(/\n\s*\n/g, '');
                html = html.replace(/\s{2,}/g, ' ');
                html = html.replace(/>\s+</g, '><');
            } else {
                html = html.replace(/\n\s*\n\s*\n/g, '\n\n');
            }
            
            return `<div style="font-family: 'PingFang SC', system-ui, -apple-system, 'Helvetica Neue', 'Microsoft YaHei', Arial, sans-serif; color: rgba(0, 0, 0, 0.9); max-width: 100%; overflow-wrap: break-word;">${html}</div>`;
        }
        
        function updateOutput() {
            const markdown = document.getElementById('markdownInput').value;
            const html = convertMarkdownToWechat(markdown);
            
            document.getElementById('htmlOutput').value = html;
            document.getElementById('preview').innerHTML = html;
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°é¢„è§ˆé¡¶éƒ¨
            document.getElementById('preview').scrollTop = 0;
        }
        
        function showTab(tabName) {
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾é¡µ
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                const success = document.execCommand('copy');
                document.body.removeChild(textArea);
                return success;
            }
        }
        
        async function copyHtml() {
            const html = document.getElementById('htmlOutput').value;
            const success = await copyToClipboard(html);
            const btn = document.getElementById('copyHtmlBtn');
            
            if (success) {
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                btn.classList.add('success');
                setTimeout(() => {
                    btn.textContent = 'å¤åˆ¶ä»£ç ';
                    btn.classList.remove('success');
                }, 2000);
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }
        }
        
        async function copyPreview() {
            const html = document.getElementById('htmlOutput').value;
            const success = await copyToClipboard(html);
            const btn = document.getElementById('copyPreviewBtn');
            
            if (success) {
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                btn.classList.add('success');
                setTimeout(() => {
                    btn.textContent = 'å¤åˆ¶æ ·å¼ä»£ç ';
                    btn.classList.remove('success');
                }, 2000);
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }
        }
        
        function loadExample() {
            const exampleMarkdown = `# AIè§†è§‰é¢†åŸŸçš„"é“ä¸‰è§’"

## ä»–ä»¬æ˜¯è°ï¼Ÿ

**Lucas Beyerã€Alexander Kolesnikov å’Œ Xiaohua Zhai** è¢«ä¸šç•Œç§°ä¸º AI è§†è§‰é¢†åŸŸçš„"é“ä¸‰è§’"ã€‚

### Vision Transformer (ViT)ï¼šç»™AIæ¢äº†å‰¯"çœ¼é•œ"

**åŸæ¥VSç°åœ¨**ï¼š

- **åŸæ¥ï¼ˆCNNæ–¹å¼ï¼‰**ï¼šåƒä¸€ä¸ªé æ”¾å¤§é•œå±€éƒ¨æŸ¥çœ‹å›¾åƒçš„äºº
    - CNN åƒä¸€ä¸ªäººæ‹¿ç€æ”¾å¤§é•œåœ¨å›¾ç‰‡ä¸Š**ä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹åœ°æ»‘åŠ¨è§‚å¯Ÿ**
    - æ¯æ¬¡åªå…³æ³¨å›¾ç‰‡çš„**å±€éƒ¨åŒºåŸŸï¼ˆå°æ–¹å—ï¼‰**ï¼Œä»ä¸­æå–çº¹ç†ã€è¾¹ç¼˜ç­‰ä¿¡æ¯
    - å¤šå±‚å åŠ åï¼Œå®ƒé€æ¸æ„å»ºå‡ºå¯¹æ•´ä½“å›¾åƒçš„ç†è§£
- **ç°åœ¨ï¼ˆViTæ–¹å¼ï¼‰**ï¼šåƒä¸€ä¸ªäººæŠŠæ•´å¼ å›¾åˆ‡æˆæ‹¼å›¾å—ï¼Œç„¶å"é˜…è¯»"è¿™äº›æ‹¼å›¾å—çš„å…³ç³»
    - ViT é¦–å…ˆæŠŠæ•´å¼ å›¾åƒ**åˆ‡æˆä¸€ä¸ªä¸ªå°å—ï¼ˆpatchï¼‰**ï¼Œæ¯ä¸ªå—åƒæ˜¯ä¸€å¼ å¡ç‰‡
    - æŠŠæ¯ä¸ªå¡ç‰‡"ç¼–ç "ä¸ºä¸€ä¸ªå‘é‡ï¼Œç„¶ååƒ Transformer çœ‹å¥å­ä¸€æ ·
        - ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶æ•æ‰å®ƒä»¬ä¹‹é—´çš„å…³ç³»
        - èƒ½åŒæ—¶å…³æ³¨å›¾ç‰‡ä»»æ„ä¸¤ä¸ªä½ç½®
    - å®ƒä¸åƒ CNN é‚£æ ·å…³æ³¨é‚»è¿‘åŒºåŸŸï¼Œè€Œæ˜¯èƒ½ä¸€å¼€å§‹å°±ä»å…¨å±€å‡ºå‘è¿›è¡Œå»ºæ¨¡

### æ ¸å¿ƒè´¡çŒ®

ä»–ä»¬çš„ä¸»è¦ç ”ç©¶æˆæœåŒ…æ‹¬ï¼š

- **Big Transfer (BiT)**ï¼šè®©AIæˆä¸º"å­¦éœ¸"
    - å¤§è§„æ¨¡é¢„è®­ç»ƒç­–ç•¥ï¼šåœ¨3äº¿å¼ å›¾ç‰‡çš„è¶…å¤§æ•°æ®é›†ä¸Šè®­ç»ƒAI
    - æ ‡å‡†åŒ–è¿ç§»æµç¨‹ï¼šå»ºç«‹äº†ä¸€å¥—"é¢„è®­ç»ƒâ†’å¾®è°ƒ"çš„æ ‡å‡†åšæ³•
    - BiT-HyperRuleè§„åˆ™ï¼šæ ¹æ®ä»»åŠ¡å¤§å°è‡ªåŠ¨è°ƒæ•´è®­ç»ƒå‚æ•°
- **Vision Transformer (ViT)**ï¼šç»™AIæ¢äº†å‰¯"çœ¼é•œ"  
    - å›¾åƒåºåˆ—åŒ–ï¼šæŠŠ2Då›¾ç‰‡å˜æˆ1Dåºåˆ—ï¼Œå°±åƒæŠŠæ–‡å­—æ’æˆä¸€è¡Œ
    - å…¨å±€æ³¨æ„åŠ›æœºåˆ¶ï¼šèƒ½åŒæ—¶å…³æ³¨å›¾ç‰‡ä»»æ„ä¸¤ä¸ªä½ç½®çš„å…³ç³»
    - ç»Ÿä¸€æ¶æ„ï¼šå›¾ç‰‡å’Œæ–‡å­—ç”¨åŒæ ·çš„Transformerå¤„ç†
- **MLP-Mixer**ï¼šæç®€ä¸»ä¹‰çš„èƒœåˆ©
    - Token-Mixing MLPï¼ˆç©ºé—´æ…æ‹Œå™¨ï¼‰ï¼šæ··åˆä¸åŒä½ç½®é—´çš„ä¿¡æ¯
    - Channel-Mixing MLPï¼ˆç‰¹å¾æ…æ‹Œå™¨ï¼‰ï¼šæ··åˆæ¯ä¸ªä½ç½®å†…éƒ¨çš„ç‰¹å¾
    - æŒ‘æˆ˜ä¼ ç»Ÿè®¤çŸ¥ï¼šè¯æ˜ç®€å•æœ‰æ—¶æ›´æœ‰æ•ˆ

### æŠ€æœ¯ç»†èŠ‚å¯¹æ¯”

ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨æ ¼ç¤ºä¾‹ï¼š

| ç‰¹æ€§ | ä¼ ç»ŸCNN | Vision Transformer (ViT) |
| :--- | :--- | :--- |
| **æ ¸å¿ƒæ“ä½œ** | å±€éƒ¨å·ç§¯ | å…¨å±€è‡ªæ³¨æ„åŠ› |
| **æ„Ÿå—é‡** | é€æ­¥æ‰©å¤§ | ä¸€å¼€å§‹å³å…¨å±€ |
| **æ•°æ®å¤„ç†** | 2Då›¾åƒæ•°ç»„ | 1Dåºåˆ—ï¼ˆPatchesï¼‰ |
| **è®¡ç®—å¤æ‚åº¦**| O(kÂ² * C_in * C_out) | O(nÂ² * d) |

ä»¥åŠæ•°å­¦å…¬å¼ï¼š

- **è¡Œå†…å…¬å¼**: è‘—åçš„è´¨èƒ½æ–¹ç¨‹æ˜¯ $E = mc^2$ã€‚
- **å—çº§å…¬å¼**: æ±‚è§£äºŒæ¬¡æ–¹ç¨‹ $ax^2 + bx + c = 0$ çš„å…¬å¼æ˜¯ï¼š
$$ x = \frac{-b \pm \sqrt{b^2-4ac}}{2a} $$

> å¦‚æœè¯´ AI æ˜¯ä¸ªä¸æ–­å­¦ä¹ çš„å­¦ç”Ÿï¼Œé‚£è¿™ä¸‰ä½å°±æ˜¯é™ªå®ƒä»"çœ‹ä¸æ‡‚å›¾ç‰‡"åˆ°"èƒ½çœ‹å›¾è¯´è¯"çš„è€å¸ˆã€‚

### åº”ç”¨åœºæ™¯å±•ç¤º

è¿™äº›æŠ€æœ¯å·²ç»è¢«å¹¿æ³›åº”ç”¨åœ¨ï¼š

- **è®¡ç®—æœºè§†è§‰é¢†åŸŸ**
    - å›¾åƒåˆ†ç±»ä»»åŠ¡
        - ImageNet æ•°æ®é›†
        - ç»†ç²’åº¦åˆ†ç±»
    - ç›®æ ‡æ£€æµ‹ä»»åŠ¡
        - COCO æ•°æ®é›†
        - å®æ—¶æ£€æµ‹ç³»ç»Ÿ
    - è¯­ä¹‰åˆ†å‰²ä»»åŠ¡
        - åƒç´ çº§åˆ†ç±»
        - åŒ»å­¦å½±åƒåˆ†æ
- **å¤šæ¨¡æ€åº”ç”¨é¢†åŸŸ**
    - å›¾æ–‡ç†è§£ä»»åŠ¡
        - çœ‹å›¾è¯´è¯
        - è§†è§‰é—®ç­”
    - è·¨æ¨¡æ€æ£€ç´¢
        - å›¾æ–‡åŒ¹é…
        - å†…å®¹æ¨è
- **å·¥ä¸šåº”ç”¨é¢†åŸŸ**
    - è‡ªåŠ¨é©¾é©¶æŠ€æœ¯
        - è·¯å†µè¯†åˆ«
        - éšœç¢ç‰©æ£€æµ‹
        - äº¤é€šæ ‡å¿—è¯†åˆ«
    - åŒ»å­¦å½±åƒè¯Šæ–­
        - Xå…‰ç‰‡åˆ†æ
        - CTæ‰«æå¤„ç†
        - ç—…ç†åˆ‡ç‰‡æ£€æŸ¥
    - æ™ºèƒ½åˆ¶é€ ç³»ç»Ÿ
        - è´¨é‡æ£€æµ‹
        - ç¼ºé™·è¯†åˆ«
        - è‡ªåŠ¨åŒ–åˆ†æ‹£

![AIè§†è§‰å‘å±•](https://via.placeholder.com/600x300/7E3AF2/ffffff?text=AI+Vision+Evolution)

**äº†è§£æ›´å¤š**ï¼š[ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†è®ºæ–‡](https://example.com)`;

            document.getElementById('markdownInput').value = exampleMarkdown;
            updateOutput();
            
            // æ»šåŠ¨åˆ°è¾“å…¥åŒºåŸŸé¡¶éƒ¨
            document.getElementById('markdownInput').scrollTop = 0;
        }
        
        // ç»‘å®šäº‹ä»¶
        document.getElementById('markdownInput').addEventListener('input', updateOutput);
        
        // åˆå§‹åŒ–
        updateOutput();
    </script>
</body>
</html>
